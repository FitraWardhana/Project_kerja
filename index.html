<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="flutter_application_2">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>flutter_application_2</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MTC A10 - Maintenance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .mobile-full-width {
                width: 100% !important;
                max-width: 100% !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
            }
            .mobile-stack {
                flex-direction: column !important;
            }
            .mobile-p-2 {
                padding: 0.5rem !important;
            }
            .mobile-text-sm {
                font-size: 0.875rem !important;
            }
            .mobile-hidden {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-sm md:text-base">
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm">
            <div class="flex justify-center mb-4">
                <div class="bg-blue-600 p-3 rounded-full">
                    <i class="fas fa-tools text-white text-3xl"></i>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">MTC A10</h2>
            <p class="text-center text-gray-600 mb-6">Maintenance Dashboard</p>
            
            <form id="login-form" class="space-y-4">
                <div class="flex items-center border-b border-gray-300 py-2">
                    <i class="fas fa-user text-gray-500 mr-2"></i>
                    <input type="text" id="login-username" class="flex-1 outline-none" placeholder="Username" required>
                </div>
                <div class="flex items-center border-b border-gray-300 py-2">
                    <i class="fas fa-lock text-gray-500 mr-2"></i>
                    <input type="password" id="login-password" class="flex-1 outline-none" placeholder="Password" required>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="remember-me" class="mr-2">
                    <label for="remember-me" class="text-sm text-gray-600">Ingat saya</label>
                </div>
                <button type="submit" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                    Masuk
                </button>
            </form>
            
            <div class="mt-4 text-center text-sm text-gray-600">
                <p>Versi 1.0.0 - Maintenance Team</p>
            </div>
        </div>
    </div>

    <div class="flex h-screen overflow-hidden" id="main-content" style="display: none;">
        <!-- Mobile Sidebar Overlay -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden" style="display: none;"></div>
        
        <!-- Sidebar -->
        <div id="sidebar" class="fixed md:relative inset-y-0 left-0 transform -translate-x-full md:translate-x-0 z-50 transition duration-200 ease-in-out md:flex md:flex-shrink-0 bg-blue-700 text-white w-64">
            <div class="flex flex-col w-full">
                <div class="flex items-center justify-between h-16 px-4 border-b border-blue-600">
                    <div class="flex items-center">
                        <i class="fas fa-tools text-white text-xl mr-2"></i>
                        <span class="text-xl font-bold">MTC A10</span>
                    </div>
                    <button class="md:hidden text-white" id="close-sidebar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex flex-col flex-grow px-2 py-4 overflow-y-auto">
                    <nav class="space-y-1">
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-blue-800" id="home-menu">
                            <i class="fas fa-home mr-3"></i>
                            Beranda
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800" id="attendance-menu">
                            <i class="fas fa-fingerprint mr-3"></i>
                            Absensi
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800" id="report-menu">
                            <i class="fas fa-file-alt mr-3"></i>
                            Laporan Perbaikan
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 admin-only" id="ticket-menu" style="display: none;">
                            <i class="fas fa-ticket-alt mr-3"></i>
                            Daftar Tiket
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 admin-only" id="user-management-menu" style="display: none;">
                            <i class="fas fa-users mr-3"></i>
                            Manajemen User
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800 admin-only" id="productivity-menu" style="display: none;">
                            <i class="fas fa-chart-pie mr-3"></i>
                            Produktivitas Team
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-blue-200 hover:bg-blue-800" id="analytics-menu">
                            <i class="fas fa-chart-line mr-3"></i>
                            Analisis Saya
                        </a>
                    </nav>
                    <div class="mt-auto px-2 py-4">
                        <div class="bg-blue-800 rounded-lg px-4 py-3">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center">
                                    <i class="fas fa-user text-white"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium" id="sidebar-username">Admin</p>
                                    <p class="text-xs text-blue-300" id="sidebar-role">Administrator</p>
                                </div>
                            </div>
                            <button id="logout-btn" class="mt-2 w-full text-left text-xs text-blue-300 hover:text-white">
                                <i class="fas fa-sign-out-alt mr-1"></i> Keluar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Top navigation -->
            <div class="flex items-center justify-between h-16 px-4 border-b border-gray-200 bg-white">
                <div class="flex items-center md:hidden">
                    <button class="text-gray-500 hover:text-gray-700 focus:outline-none" id="mobile-menu-button">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <div class="flex-1 text-center md:text-left px-2">
                    <h1 class="text-lg font-semibold text-gray-800" id="page-title">Dashboard</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <button class="relative text-gray-500 hover:text-gray-700 focus:outline-none" id="notifications-button">
                            <i class="fas fa-bell"></i>
                            <span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"></span>
                        </button>
                        <div id="notifications-dropdown" class="hidden absolute right-0 mt-2 w-72 bg-white rounded-md shadow-lg z-50 py-1">
                            <div class="px-4 py-2 border-b border-gray-200">
                                <p class="text-sm font-medium text-gray-700">Notifikasi</p>
                            </div>
                            <div id="notifications-list" class="max-h-60 overflow-y-auto">
                                <!-- Notifications will be loaded here -->
                                <div class="px-4 py-3 text-center text-sm text-gray-500">
                                    Tidak ada notifikasi baru
                                </div>
                            </div>
                            <div class="px-4 py-2 border-t border-gray-200 text-center">
                                <a href="#" class="text-xs text-blue-600 hover:text-blue-800">Lihat Semua</a>
                            </div>
                        </div>
                    </div>
                    <div class="relative">
                        <button class="flex items-center text-sm font-medium focus:outline-none" id="user-menu-button">
                            <span class="sr-only">Open user menu</span>
                            <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center">
                                <i class="fas fa-user text-gray-600"></i>
                            </div>
                            <span class="ml-2 hidden md:inline-block" id="topbar-username">Admin</span>
                        </button>
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50 py-1">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="profile-btn">
                                <i class="fas fa-user-circle mr-2"></i> Profil
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="settings-btn">
                                <i class="fas fa-cog mr-2"></i> Pengaturan
                            </a>
                            <div class="border-t border-gray-200"></div>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="dropdown-logout-btn">
                                <i class="fas fa-sign-out-alt mr-2"></i> Keluar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main content area -->
            <div class="flex-1 overflow-auto p-4 bg-gray-50" id="content-area">
                <!-- Dashboard Content -->
                <div id="dashboard-content">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-3 mobile-stack">
                        <!-- Attendance Card -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-4">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-md font-semibold text-gray-800">Absensi Hari Ini</h2>
                                    <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800" id="attendance-status">Aktif</span>
                                </div>
                                <div id="location-display" class="mt-3 text-xs text-gray-600 flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2"></i>
                                    <span>Menentukan lokasi...</span>
                                </div>
                                <div class="mt-4 flex justify-center">
                                    <button id="attendance-btn" class="px-6 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                                        Absen Masuk
                                    </button>
                                </div>
                                <div class="mt-3" style="display:none" id="attendance-records">
                                    <p class="text-xs text-gray-500">Rekaman hari ini:</p>
                                    <div class="mt-1 space-y-1">
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-600">Absen Masuk:</span>
                                            <span id="clock-in-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-600">Absen Keluar:</span>
                                            <span id="clock-out-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-600">Durasi:</span>
                                            <span id="work-duration" class="font-medium text-blue-600">0h 0m</span>
                                        </div>
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-600">Lokasi:</span>
                                            <span id="attendance-location" class="font-medium">--</span>
                                        </div>
                                        <div class="flex justify-end">
                                            <button id="delete-attendance" class="text-red-600 hover:text-red-900 text-xs font-medium">
                                                <i class="fas fa-trash-alt mr-1"></i> Hapus
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productivity Stats -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1" style="display:none" id="analytics-section">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Produktivitas</h2>
                                <div class="mt-4">
                                    <div class="relative h-32">
                                        <canvas id="productivityChart"></canvas>
                                    </div>
                                    <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                                        <div>
                                            <p class="text-xs text-gray-500">Perbaikan Selesai</p>
                                            <p id="tasks-completed" class="text-xl font-bold text-blue-600">0</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Rata Fokus</p>
                                            <p id="avg-focus-time" class="text-xl font-bold text-blue-600">0h 0m</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Efisiensi</p>
                                            <p id="efficiency-score" class="text-xl font-bold text-blue-600">0%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Recommendations -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Rekomendasi</h2>
                                <div class="mt-4">
                                    <div class="flex items-start">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-lightbulb text-blue-500 text-xl"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-xs text-gray-600" id="ai-recommendation">
                                                Mulailah hari Anda dengan membuat daftar perbaikan prioritas. Fokus pada perbaikan penting terlebih dahulu.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Report Section -->
                    <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2 mobile-stack">
                        <!-- Submit Report -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Laporan Perbaikan</h2>
                                <form id="report-form" class="mt-3 space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Nama Toko</label>
                                        <input type="text" id="report-store-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Kode Toko</label>
                                        <input type="text" id="report-store-code" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">No Complain Online</label>
                                        <input type="text" id="report-complain-number" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Deskripsi Perbaikan</label>
                                        <textarea id="report-description" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Status Perbaikan</label>
                                        <select id="report-status" class="mt-1 block w-full pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                            <option value="pending">Pending</option>
                                            <option value="in-progress">Dalam Proses</option>
                                            <option value="completed">Selesai</option>
                                            <option value="proposal">Usulan</option>
                                        </select>
                                    </div>
                                    <div>
                                        <button type="submit" id="submit-report-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            Submit Laporan
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Report Display -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden" style="display:none" id="report-section">
                            <div class="p-4">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-md font-semibold text-gray-800">Laporan Terakhir</h2>
                                    <div class="flex space-x-2">
                                        <button id="edit-report-btn" class="text-blue-600 hover:text-blue-900 text-xs font-medium">
                                            <i class="fas fa-edit mr-1"></i>
                                            Edit
                                        </button>
                                        <button id="delete-report-btn" class="text-red-600 hover:text-red-900 text-xs font-medium">
                                            <i class="fas fa-trash-alt mr-1"></i>
                                            Hapus
                                        </button>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="grid grid-cols-2 gap-2 mb-2">
                                        <div>
                                            <p class="text-xs text-gray-500">Nama Toko:</p>
                                            <p id="report-store-name-display" class="text-sm font-medium"></p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Kode Toko:</p>
                                            <p id="report-store-code-display" class="text-sm font-medium"></p>
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <p class="text-xs text-gray-500">No Complain:</p>
                                        <p id="report-complain-number-display" class="text-sm font-medium"></p>
                                    </div>
                                    <div class="mb-2">
                                        <p class="text-xs text-gray-500">Deskripsi:</p>
                                        <p id="report-description-display" class="text-sm"></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Status:</p>
                                        <span id="report-status-display" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Content (hidden by default) -->
                <div id="attendance-content" style="display: none;">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-4">
                            <h2 class="text-md font-semibold text-gray-800">Riwayat Absensi</h2>
                            <div class="mt-3">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 text-xs">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Masuk</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keluar</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durasi</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider admin-only" style="display: none;">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200 text-xs" id="attendance-history">
                                            <!-- Attendance records will be loaded here -->
                                            <tr>
                                                <td colspan="6" class="px-3 py-4 text-center text-gray-500">Memuat data...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Content (hidden by default) -->
                <div id="report-content" style="display: none;">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-4">
                            <h2 class="text-md font-semibold text-gray-800">Riwayat Laporan Perbaikan</h2>
                            <div class="mt-3">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 text-xs">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Toko</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Toko</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200 text-xs" id="report-history">
                                            <!-- Report records will be loaded here -->
                                            <tr>
                                                <td colspan="5" class="px-3 py-4 text-center text-gray-500">Memuat data...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Content (hidden by default) -->
                <div id="ticket-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-3 mobile-stack">
                        <!-- Create Ticket -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Buat Tiket Baru</h2>
                                <form id="ticket-form" class="mt-3 space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Judul Tiket</label>
                                        <input type="text" id="ticket-title" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Deskripsi</label>
                                        <textarea id="ticket-description" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Prioritas</label>
                                        <select id="ticket-priority" class="mt-1 block w-full pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                            <option value="low">Rendah</option>
                                            <option value="medium" selected>Sedang</option>
                                            <option value="high">Tinggi</option>
                                        </select>
                                    </div>
                                    <div>
                                        <button type="submit" id="submit-ticket-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            Buat Tiket
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Ticket List -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-4">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-md font-semibold text-gray-800">Daftar Tiket</h2>
                                    <div class="flex space-x-2">
                                        <select id="ticket-filter" class="mt-1 block pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                            <option value="all">Semua</option>
                                            <option value="open">Open</option>
                                            <option value="in-progress">In Progress</option>
                                            <option value="resolved">Resolved</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="overflow-y-auto" style="max-height: 500px;">
                                        <div class="space-y-3" id="ticket-list">
                                            <!-- Tickets will be loaded here -->
                                            <div class="text-center py-8 text-gray-500">
                                                <i class="fas fa-ticket-alt text-3xl mx-auto text-gray-300 mb-2"></i>
                                                <p class="text-sm">Belum ada tiket yang dibuat</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Content (hidden by default) -->
                <div id="user-management-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-3 mobile-stack">
                        <!-- Add User Form -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Tambah User Baru</h2>
                                <form id="user-form" class="mt-3 space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Nama Lengkap</label>
                                        <input type="text" id="user-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Username</label>
                                        <input type="text" id="user-username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Password</label>
                                        <input type="password" id="user-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-xs" required>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Role</label>
                                        <select id="user-role" class="mt-1 block w-full pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                            <option value="Teknisi">Teknisi</option>
                                            <option value="Administrator">Administrator</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700">Departemen</label>
                                        <select id="user-department" class="mt-1 block w-full pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                            <option value="Listrik">Listrik</option>
                                            <option value="SIPIL">SIPIL</option>
                                            <option value="CCTV">CCTV</option>
                                            <option value="IT">IT</option>
                                        </select>
                                    </div>
                                    <div>
                                        <button type="submit" id="submit-user-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            Tambah User
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- User List -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-4">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-md font-semibold text-gray-800">Daftar User</h2>
                                    <div class="flex space-x-2">
                                        <input type="text" id="user-search" placeholder="Cari user..." class="mt-1 block pl-2 pr-8 py-2 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="overflow-y-auto" style="max-height: 500px;">
                                        <table class="min-w-full divide-y divide-gray-200 text-xs">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-3 py-2 text-left">Nama</th>
                                                    <th class="px-3 py-2 text-left">Username</th>
                                                    <th class="px-3 py-2 text-left">Role</th>
                                                    <th class="px-3 py-2 text-left">Departemen</th>
                                                    <th class="px-3 py-2 text-left">Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200" id="user-list">
                                                <!-- Users will be loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-3 py-4 text-center text-gray-500">Memuat data...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Productivity Content (hidden by default) -->
                <div id="productivity-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 mobile-stack">
                        <!-- Team Productivity Chart -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Produktivitas Team</h2>
                                <div class="mt-3">
                                    <div class="relative h-48">
                                        <canvas id="team-productivity-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Task Distribution -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Distribusi Perbaikan</h2>
                                <div class="mt-3">
                                    <div class="relative h-48">
                                        <canvas id="team-task-distribution-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Metrik Kinerja Team</h2>
                                <div class="mt-4">
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200 text-xs">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-3 py-2 text-left">Nama</th>
                                                    <th class="px-3 py-2 text-left">Total Perbaikan</th>
                                                    <th class="px-3 py-2 text-left">Selesai</th>
                                                    <th class="px-3 py-2 text-left">Dalam Proses</th>
                                                    <th class="px-3 py-2 text-left">Pending</th>
                                                    <th class="px-3 py-2 text-left">Efisiensi</th>
                                                    <th class="px-3 py-2 text-left">Rata Jam Kerja</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200" id="team-performance-list">
                                                <!-- Team performance will be loaded here -->
                                                <tr>
                                                    <td colspan="7" class="px-3 py-4 text-center text-gray-500">Memuat data...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Content (hidden by default) -->
                <div id="analytics-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 mobile-stack">
                        <!-- Productivity Chart -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Produktivitas Mingguan</h2>
                                <div class="mt-3">
                                    <div class="relative h-48">
                                        <canvas id="weekly-productivity-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Task Distribution -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Distribusi Perbaikan</h2>
                                <div class="mt-3">
                                    <div class="relative h-48">
                                        <canvas id="task-distribution-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-4">
                                <h2 class="text-md font-semibold text-gray-800">Metrik Kinerja</h2>
                                <div class="mt-4 grid grid-cols-2 gap-3 md:grid-cols-4">
                                    <div class="bg-blue-50 rounded-lg p-3">
                                        <p class="text-xs font-medium text-blue-800">Rata-rata Jam Kerja</p>
                                        <p class="mt-1 text-xl font-bold text-blue-600" id="avg-work-hours">0h 0m</p>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-3">
                                        <p class="text-xs font-medium text-green-800">Perbaikan Selesai</p>
                                        <p class="mt-1 text-xl font-bold text-green-600" id="total-completed-tasks">0</p>
                                    </div>
                                    <div class="bg-yellow-50 rounded-lg p-3">
                                        <p class="text-xs font-medium text-yellow-800">Perbaikan Tertunda</p>
                                        <p class="mt-1 text-xl font-bold text-yellow-600" id="total-pending-tasks">0</p>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-3">
                                        <p class="text-xs font-medium text-purple-800">Skor Produktivitas</p>
                                        <p class="mt-1 text-xl font-bold text-purple-600" id="productivity-score">0%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-sm w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-gray-800">Profil Pengguna</h2>
                <button id="close-profile-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="flex flex-col items-center mb-4">
                <div class="h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                    <i class="fas fa-user text-blue-600 text-2xl"></i>
                </div>
                <h3 id="profile-name" class="text-lg font-semibold"></h3>
                <p id="profile-role" class="text-sm text-gray-600"></p>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="block text-xs font-medium text-gray-700">Username</label>
                    <p id="profile-username" class="mt-1 text-sm"></p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700">Departemen</label>
                    <p id="profile-department" class="mt-1 text-sm"></p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700">Bergabung Sejak</label>
                    <p id="profile-join-date" class="mt-1 text-sm"></p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700">Total Laporan</label>
                    <p id="profile-total-reports" class="mt-1 text-sm"></p>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700">Total Absensi</label>
                    <p id="profile-total-attendance" class="mt-1 text-sm"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== SIMULATED DATABASE ====================
        const db = {
            users: [
                { 
                    id: 1, 
                    username: 'admin', 
                    password: 'admin123', 
                    name: 'Administrator', 
                    role: 'Administrator',
                    joinDate: '2023-01-01',
                    department: 'Maintenance'
                },
                { 
                    id: 2, 
                    username: 'user1', 
                    password: 'user123', 
                    name: 'Teknisi Listrik', 
                    role: 'Teknisi',
                    joinDate: '2023-02-15',
                    department: 'Listrik'
                },
                { 
                    id: 3, 
                    username: 'user2', 
                    password: 'user123', 
                    name: 'Teknisi SIPIL', 
                    role: 'Teknisi',
                    joinDate: '2023-03-10',
                    department: 'SIPIL'
                },
                { 
                    id: 4, 
                    username: 'user3', 
                    password: 'user123', 
                    name: 'Teknisi CCTV', 
                    role: 'Teknisi',
                    joinDate: '2023-04-05',
                    department: 'CCTV'
                }
            ],
            attendance: [
                // Contoh data absensi sebelumnya untuk demo
                {
                    id: 1,
                    userId: 1,
                    date: new Date().toISOString().split('T')[0],
                    clockIn: new Date(new Date().setHours(8, 30, 0)),
                    location: "Kantor Pusat, Jakarta",
                    status: "present"
                }
            ],
            reports: [],
            tickets: [],
            notifications: [
                {
                    id: 1,
                    userId: 1,
                    title: "Selamat Datang",
                    message: "Selamat menggunakan sistem MTC A10",
                    date: new Date().toISOString(),
                    read: false
                }
            ]
        };

        // ==================== STATE MANAGEMENT ====================
        let currentUser = null;
        let todayAttendance = null;
        let productivityChart = null;
        let weeklyProductivityChart = null;
        let taskDistributionChart = null;
        let teamProductivityChart = null;
        let teamTaskDistributionChart = null;

        // ==================== DOM ELEMENTS ====================
        const loginModal = document.getElementById('login-modal');
        const mainContent = document.getElementById('main-content');
        const loginForm = document.getElementById('login-form');
        const attendanceBtn = document.getElementById('attendance-btn');
        const deleteAttendanceBtn = document.getElementById('delete-attendance');
        const reportForm = document.getElementById('report-form');
        const editReportBtn = document.getElementById('edit-report-btn');
        const deleteReportBtn = document.getElementById('delete-report-btn');
        const ticketForm = document.getElementById('ticket-form');
        const ticketFilter = document.getElementById('ticket-filter');
        const userForm = document.getElementById('user-form');
        const userSearch = document.getElementById('user-search');
        const profileModal = document.getElementById('profile-modal');
        const logoutBtn = document.getElementById('logout-btn');
        const dropdownLogoutBtn = document.getElementById('dropdown-logout-btn');
        const profileBtn = document.getElementById('profile-btn');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const closeSidebar = document.getElementById('close-sidebar');
        const mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');
        const sidebar = document.getElementById('sidebar');
        const notificationsButton = document.getElementById('notifications-button');
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.getElementById('user-dropdown');

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const token = localStorage.getItem('token');
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (token && rememberMe) {
                currentUser = JSON.parse(localStorage.getItem('user'));
                initializeApp();
            } else if (token) {
                // If not remember me, clear storage when browser closed
                currentUser = JSON.parse(sessionStorage.getItem('user'));
                initializeApp();
            }

            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);

            // Navigation menu
            document.getElementById('home-menu').addEventListener('click', showDashboard);
            document.getElementById('attendance-menu').addEventListener('click', showAttendanceContent);
            document.getElementById('report-menu').addEventListener('click', showReportContent);
            document.getElementById('ticket-menu').addEventListener('click', showTicketContent);
            document.getElementById('user-management-menu').addEventListener('click', showUserManagementContent);
            document.getElementById('productivity-menu').addEventListener('click', showTeamProductivityContent);
            document.getElementById('analytics-menu').addEventListener('click', showAnalyticsContent);

            // Attendance
            attendanceBtn.addEventListener('click', handleAttendance);
            deleteAttendanceBtn.addEventListener('click', deleteAttendance);

            // Report
            reportForm.addEventListener('submit', submitReport);
            editReportBtn.addEventListener('click', editReport);
            deleteReportBtn.addEventListener('click', deleteReport);

            // Ticket
            ticketForm.addEventListener('submit', submitTicket);
            ticketFilter.addEventListener('change', filterTickets);
            
            // User Management
            userForm.addEventListener('submit', addUser);
            userSearch.addEventListener('input', searchUsers);
            
            // Profile and logout
            profileBtn.addEventListener('click', showProfile);
            logoutBtn.addEventListener('click', handleLogout);
            dropdownLogoutBtn.addEventListener('click', handleLogout);
            
            // Mobile menu
            mobileMenuButton.addEventListener('click', toggleMobileSidebar);
            closeSidebar.addEventListener('click', toggleMobileSidebar);
            mobileSidebarOverlay.addEventListener('click', toggleMobileSidebar);
            
            // Notifications dropdown
            notificationsButton.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationsDropdown.classList.toggle('hidden');
                userDropdown.classList.add('hidden');
                
                // Mark notifications as read when opened
                markNotificationsAsRead();
            });
            
            // User dropdown
            userMenuButton.addEventListener('click', function(e) {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
                notificationsDropdown.classList.add('hidden');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function() {
                notificationsDropdown.classList.add('hidden');
                userDropdown.classList.add('hidden');
            });
            
            // Profile modal
            document.getElementById('close-profile-modal').addEventListener('click', function() {
                profileModal.classList.add('hidden');
            });
        }

        function initializeApp() {
            // Hide login modal, show main content
            loginModal.style.display = 'none';
            mainContent.style.display = 'flex';

            // Load data from localStorage
            loadFromLocalStorage();

            // Update UI based on user role
            updateUIForUserRole();

            // Update UI
            updateUserInfo();
            checkAttendanceStatus();
            loadReports();
            loadTickets();
            loadNotifications();

            // Show dashboard by default
            showDashboard();
        }

        function updateUIForUserRole() {
            if (currentUser.role === 'Administrator') {
                // Show all admin features
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'flex';
                });
            } else {
                // Hide admin features for regular users
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
            }
        }

        function loadFromLocalStorage() {
            const savedUser = localStorage.getItem('user') || sessionStorage.getItem('user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }

            const savedAttendance = localStorage.getItem('attendance');
            if (savedAttendance) {
                db.attendance = JSON.parse(savedAttendance);
                // Convert string dates back to Date objects
                db.attendance.forEach(att => {
                    if (att.clockIn) att.clockIn = new Date(att.clockIn);
                    if (att.clockOut) att.clockOut = new Date(att.clockOut);
                });
            }

            const savedReports = localStorage.getItem('reports');
            if (savedReports) {
                db.reports = JSON.parse(savedReports);
            }

            const savedTickets = localStorage.getItem('tickets');
            if (savedTickets) {
                db.tickets = JSON.parse(savedTickets);
            }

            const savedNotifications = localStorage.getItem('notifications');
            if (savedNotifications) {
                db.notifications = JSON.parse(savedNotifications);
            }

            // Find today's attendance
            const today = new Date().toISOString().split('T')[0];
            todayAttendance = db.attendance.find(a => 
                a.userId === currentUser.id && 
                a.date === today
            );
        }

        function saveToLocalStorage() {
            const rememberMe = document.getElementById('remember-me').checked;
            
            if (rememberMe) {
                localStorage.setItem('user', JSON.stringify(currentUser));
                localStorage.setItem('rememberMe', 'true');
            } else {
                sessionStorage.setItem('user', JSON.stringify(currentUser));
                localStorage.removeItem('rememberMe');
            }
            
            localStorage.setItem('attendance', JSON.stringify(db.attendance));
            localStorage.setItem('reports', JSON.stringify(db.reports));
            localStorage.setItem('tickets', JSON.stringify(db.tickets));
            localStorage.setItem('notifications', JSON.stringify(db.notifications));
            localStorage.setItem('users', JSON.stringify(db.users));
        }

        // ==================== AUTHENTICATION ====================
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            const user = db.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('token', 'simulated-token');
                
                if (rememberMe) {
                    localStorage.setItem('user', JSON.stringify(user));
                    localStorage.setItem('rememberMe', 'true');
                } else {
                    sessionStorage.setItem('user', JSON.stringify(user));
                }
                
                loginModal.style.display = 'none';
                initializeApp();
                
                // Add login notification
                addNotification(`Selamat datang, ${user.name}!`, `Anda berhasil login sebagai ${user.role}.`);
            } else {
                alert('Username atau password salah');
            }
        }

        function handleLogout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('rememberMe');
                sessionStorage.removeItem('user');
                
                // Redirect to login
                window.location.reload();
            }
        }

        // ==================== NOTIFICATION SYSTEM ====================
        function addNotification(title, message) {
            const notification = {
                id: Date.now(),
                userId: currentUser.id,
                title,
                message,
                date: new Date().toISOString(),
                read: false
            };
            
            db.notifications.push(notification);
            saveToLocalStorage();
            loadNotifications();
            
            // Show notification badge
            document.querySelector('#notifications-button span').classList.remove('hidden');
        }

        function loadNotifications() {
            const notificationsList = document.getElementById('notifications-list');
            notificationsList.innerHTML = '';
            
            const userNotifications = db.notifications
                .filter(n => n.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="px-4 py-3 text-center text-sm text-gray-500">
                        Tidak ada notifikasi baru
                    </div>
                `;
                return;
            }
            
            userNotifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `px-4 py-3 border-b border-gray-200 ${notification.read ? 'bg-white' : 'bg-blue-50'}`;
                notificationItem.innerHTML = `
                    <div class="flex justify-between">
                        <p class="text-sm font-medium ${notification.read ? 'text-gray-700' : 'text-blue-700'}">${notification.title}</p>
                        <span class="text-xs text-gray-500">${new Date(notification.date).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>
                    <p class="mt-1 text-xs ${notification.read ? 'text-gray-500' : 'text-blue-600'}">${notification.message}</p>
                `;
                
                notificationsList.appendChild(notificationItem);
            });
            
            // Update notification badge
            const unreadCount = userNotifications.filter(n => !n.read).length;
            const badge = document.querySelector('#notifications-button span');
            
            if (unreadCount > 0) {
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function markNotificationsAsRead() {
            db.notifications.forEach(notification => {
                if (notification.userId === currentUser.id && !notification.read) {
                    notification.read = true;
                }
            });
            
            saveToLocalStorage();
            loadNotifications();
        }

        // ==================== PROFILE SYSTEM ====================
        function showProfile() {
            // Fill profile data
            document.getElementById('profile-name').textContent = currentUser.name;
            document.getElementById('profile-role').textContent = currentUser.role;
            document.getElementById('profile-username').textContent = currentUser.username;
            document.getElementById('profile-department').textContent = currentUser.department;
            document.getElementById('profile-join-date').textContent = new Date(currentUser.joinDate).toLocaleDateString('id-ID');
            
            // Calculate stats
            const totalReports = db.reports.filter(r => r.userId === currentUser.id).length;
            const totalAttendance = db.attendance.filter(a => a.userId === currentUser.id).length;
            
            document.getElementById('profile-total-reports').textContent = totalReports;
            document.getElementById('profile-total-attendance').textContent = totalAttendance;
            
            // Show modal
            profileModal.classList.remove('hidden');
            
            // Close dropdowns
            userDropdown.classList.add('hidden');
            notificationsDropdown.classList.add('hidden');
        }

        // ==================== MOBILE MENU ====================
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-sidebar-overlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.style.display = 'block';
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.style.display = 'none';
            }
        }

        // ==================== ATTENDANCE SYSTEM ====================
        async function handleAttendance() {
            const btn = document.getElementById('attendance-btn');
            
            if (btn.textContent === 'Absen Masuk') {
                const location = await getSimulatedLocation();
                document.getElementById('location-display').innerHTML = `
                    <i class="fas fa-map-marker-alt mr-2"></i>
                    <span>${location}</span>
                `;
                
                // Create new attendance record
                const now = new Date();
                todayAttendance = {
                    id: Date.now(),
                    userId: currentUser.id,
                    date: now.toISOString().split('T')[0],
                    clockIn: now,
                    location,
                    status: 'present'
                };
                
                db.attendance.push(todayAttendance);
                saveToLocalStorage();
                
                updateAttendanceUI(todayAttendance);
                btn.textContent = 'Absen Keluar';
                
                // Add notification
                addNotification('Absen Masuk', `Anda telah melakukan absen masuk pada ${now.toLocaleTimeString('id-ID')}`);
            } else {
                // Process clock out
                const now = new Date();
                
                if (todayAttendance) {
                    todayAttendance.clockOut = now;
                    todayAttendance.duration = Math.round((todayAttendance.clockOut - todayAttendance.clockIn) / (1000 * 60));
                    
                    // Update in db
                    const index = db.attendance.findIndex(a => a.id === todayAttendance.id);
                    if (index !== -1) {
                        db.attendance[index] = todayAttendance;
                    }
                    
                    saveToLocalStorage();
                    
                    updateAttendanceUI(todayAttendance);
                    btn.style.display = 'none';
                    
                    // Add notification
                    addNotification('Absen Keluar', `Anda telah melakukan absen keluar pada ${now.toLocaleTimeString('id-ID')}`);
                    
                    // Show productivity data
                    showProductivityData();
                }
            }
        }

        function updateAttendanceUI(attendance) {
            const recordsDiv = document.getElementById('attendance-records');
            recordsDiv.style.display = 'block';
            
            if (attendance.clockIn) {
                document.getElementById('clock-in-time').textContent = 
                    attendance.clockIn.toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
            }
            
            if (attendance.clockOut) {
                document.getElementById('clock-out-time').textContent = 
                    attendance.clockOut.toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
                
                if (attendance.duration) {
                    const hours = Math.floor(attendance.duration / 60);
                    const minutes = attendance.duration % 60;
                    document.getElementById('work-duration').textContent = 
                        `${hours}h ${minutes}m`;
                }
            }
            
            if (attendance.location) {
                document.getElementById('attendance-location').textContent = 
                    attendance.location;
            }
        }

        function checkAttendanceStatus() {
            const today = new Date().toISOString().split('T')[0];
            const btn = document.getElementById('attendance-btn');
            
            // Find today's attendance
            todayAttendance = db.attendance.find(a => 
                a.userId === currentUser.id && 
                a.date === today
            );
            
            if (todayAttendance) {
                updateAttendanceUI(todayAttendance);
                
                if (todayAttendance.clockIn && !todayAttendance.clockOut) {
                    btn.textContent = 'Absen Keluar';
                } else if (todayAttendance.clockIn && todayAttendance.clockOut) {
                    btn.style.display = 'none';
                    showProductivityData();
                }
            }
        }

        function deleteAttendance() {
            if (todayAttendance) {
                db.attendance = db.attendance.filter(a => a.id !== todayAttendance.id);
                todayAttendance = null;
                saveToLocalStorage();
                
                document.getElementById('attendance-records').style.display = 'none';
                const btn = document.getElementById('attendance-btn');
                btn.style.display = 'block';
                btn.textContent = 'Absen Masuk';
                
                document.getElementById('location-display').innerHTML = `
                    <i class="fas fa-map-marker-alt mr-2"></i>
                    <span>Menentukan lokasi...</span>
                `;
                
                // Add notification
                addNotification('Absen Dihapus', 'Absensi hari ini telah dihapus');
            }
        }

        async function getSimulatedLocation() {
            const locations = [
                "Kantor Pusat, Jakarta",
                "Kantor Cabang, Bandung",
                "Work From Home",
                "Kantor Client, Surabaya"
            ];
            return locations[Math.floor(Math.random() * locations.length)];
        }

        // ==================== REPORT SYSTEM ====================
        function submitReport(e) {
            e.preventDefault();
            
            const storeName = document.getElementById('report-store-name').value;
            const storeCode = document.getElementById('report-store-code').value;
            const complainNumber = document.getElementById('report-complain-number').value;
            const description = document.getElementById('report-description').value;
            const status = document.getElementById('report-status').value;
            
            // Create new report
            const report = {
                id: Date.now(),
                userId: currentUser.id,
                userName: currentUser.name,
                storeName,
                storeCode,
                complainNumber,
                description,
                status,
                date: new Date().toISOString()
            };
            
            db.reports.push(report);
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('report-form').reset();
            
            // Show report
            showReport(report);
            showProductivityData();
            
            // Add notification
            addNotification('Laporan Baru', `Laporan perbaikan untuk toko ${storeName} telah dibuat`);
        }

        function showReport(report) {
            const reportSection = document.getElementById('report-section');
            reportSection.style.display = 'block';
            
            document.getElementById('report-store-name-display').textContent = report.storeName;
            document.getElementById('report-store-code-display').textContent = report.storeCode;
            document.getElementById('report-complain-number-display').textContent = report.complainNumber || '-';
            document.getElementById('report-description-display').textContent = report.description;
            
            const statusDisplay = document.getElementById('report-status-display');
            statusDisplay.textContent = 
                report.status === 'completed' ? 'Selesai' : 
                report.status === 'in-progress' ? 'Dalam Proses' : 
                report.status === 'proposal' ? 'Usulan' : 'Pending';
            
            statusDisplay.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' + 
                (report.status === 'completed' ? 'bg-green-100 text-green-800' : 
                 report.status === 'in-progress' ? 'bg-yellow-100 text-yellow-800' : 
                 report.status === 'proposal' ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800');
            
            // Store current report ID for edit/delete
            reportSection.setAttribute('data-report-id', report.id);
        }

        function editReport() {
            const reportId = parseInt(document.getElementById('report-section').getAttribute('data-report-id'));
            const report = db.reports.find(r => r.id === reportId);
            if (!report) return;
            
            // Fill form with report data
            document.getElementById('report-store-name').value = report.storeName;
            document.getElementById('report-store-code').value = report.storeCode;
            document.getElementById('report-complain-number').value = report.complainNumber;
            document.getElementById('report-description').value = report.description;
            document.getElementById('report-status').value = report.status;
            
            // Hide report display
            document.getElementById('report-section').style.display = 'none';
            
            // Update submit button to say "Update"
            document.getElementById('submit-report-btn').textContent = 'Update Laporan';
            
            // Change form submit handler to update instead of create
            document.getElementById('report-form').onsubmit = function(e) {
                e.preventDefault();
                updateReport(reportId);
            };
        }

        function updateReport(reportId) {
            const reportIndex = db.reports.findIndex(r => r.id === reportId);
            if (reportIndex === -1) return;
            
            const storeName = document.getElementById('report-store-name').value;
            const storeCode = document.getElementById('report-store-code').value;
            const complainNumber = document.getElementById('report-complain-number').value;
            const description = document.getElementById('report-description').value;
            const status = document.getElementById('report-status').value;
            
            // Update report
            db.reports[reportIndex] = {
                ...db.reports[reportIndex],
                storeName,
                storeCode,
                complainNumber,
                description,
                status,
                updatedAt: new Date().toISOString()
            };
            
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('report-form').reset();
            document.getElementById('submit-report-btn').textContent = 'Submit Laporan';
            
            // Show updated report
            showReport(db.reports[reportIndex]);
            showProductivityData();
            
            // Add notification
            addNotification('Laporan Diupdate', `Laporan perbaikan untuk toko ${storeName} telah diupdate`);
            
            // Restore original submit handler
            document.getElementById('report-form').onsubmit = submitReport;
        }

        function deleteReport() {
            const reportId = parseInt(document.getElementById('report-section').getAttribute('data-report-id'));
            const report = db.reports.find(r => r.id === reportId);
            
            if (report && confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                db.reports = db.reports.filter(r => r.id !== reportId);
                saveToLocalStorage();
                
                document.getElementById('report-section').style.display = 'none';
                document.getElementById('report-form').reset();
                showProductivityData();
                
                // Add notification
                addNotification('Laporan Dihapus', `Laporan perbaikan untuk toko ${report.storeName} telah dihapus`);
            }
        }

        function loadReports() {
            // For dashboard - load latest report
            const userReports = db.reports
                .filter(r => r.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userReports.length > 0) {
                showReport(userReports[0]);
            }
        }

        function loadReportHistory() {
            const historyBody = document.getElementById('report-history');
            historyBody.innerHTML = '';
            
            const userReports = db.reports
                .filter(r => r.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userReports.length === 0) {
                historyBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-3 py-4 text-center text-xs text-gray-500">
                            Tidak ada riwayat laporan
                        </td>
                    </tr>
                `;
                return;
            }
            
            userReports.forEach(report => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${new Date(report.date).toLocaleDateString('id-ID')}
                    </td>
                    <td class="px-3 py-2 text-xs text-gray-500">
                        ${report.storeName}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${report.storeCode}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            report.status === 'completed' ? 'bg-green-100 text-green-800' :
                            report.status === 'in-progress' ? 'bg-yellow-100 text-yellow-800' :
                            report.status === 'proposal' ? 'bg-blue-100 text-blue-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${report.status === 'completed' ? 'Selesai' : 
                              report.status === 'in-progress' ? 'Dalam Proses' : 
                              report.status === 'proposal' ? 'Usulan' : 'Pending'}
                        </span>
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-right text-xs font-medium">
                        <button class="text-blue-600 hover:text-blue-900 mr-2 view-report" data-id="${report.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 delete-report" data-id="${report.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                historyBody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const report = db.reports.find(r => r.id === id);
                    if (report) {
                        showReport(report);
                        showDashboard();
                    }
                });
            });
            
            document.querySelectorAll('.delete-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const report = db.reports.find(r => r.id === id);
                    
                    if (report && confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                        db.reports = db.reports.filter(r => r.id !== id);
                        saveToLocalStorage();
                        loadReportHistory();
                        
                        // Add notification
                        addNotification('Laporan Dihapus', `Laporan perbaikan untuk toko ${report.storeName} telah dihapus`);
                    }
                });
            });
        }

        // ==================== TICKET SYSTEM ====================
        function submitTicket(e) {
            e.preventDefault();
            
            const title = document.getElementById('ticket-title').value;
            const description = document.getElementById('ticket-description').value;
            const priority = document.getElementById('ticket-priority').value;
            
            // Create new ticket
            const ticket = {
                id: Date.now(),
                userId: currentUser.id,
                title,
                description,
                status: 'open',
                priority,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.name
            };
            
            db.tickets.push(ticket);
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('ticket-form').reset();
            
            // Reload tickets
            loadTickets();
            
            // Add notification
            addNotification('Tiket Baru', `Tiket "${title}" telah dibuat dengan prioritas ${priority}`);
            
            // If admin, show ticket content
            if (currentUser.role === 'Administrator') {
                showTicketContent();
            }
        }

        function loadTickets(filter = 'all') {
            const ticketList = document.getElementById('ticket-list');
            ticketList.innerHTML = '';
            
            let userTickets = db.tickets
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filter !== 'all') {
                userTickets = userTickets.filter(t => t.status === filter);
            }
            
            if (userTickets.length === 0) {
                ticketList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-ticket-alt text-3xl mx-auto text-gray-300 mb-2"></i>
                        <p class="text-sm">Tidak ada tiket yang ditemukan</p>
                    </div>
                `;
                return;
            }
            
            userTickets.forEach(ticket => {
                const ticketItem = document.createElement('div');
                ticketItem.className = 'bg-white rounded-lg shadow p-3';
                
                const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-green-100 text-green-800'
                };
                
                const statusColors = {
                    open: 'bg-blue-100 text-blue-800',
                    'in-progress': 'bg-purple-100 text-purple-800',
                    resolved: 'bg-gray-100 text-gray-800'
                };
                
                ticketItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-gray-900">${ticket.title}</h3>
                            <p class="mt-1 text-xs text-gray-600">${ticket.description}</p>
                            <p class="mt-1 text-xs text-gray-500">Dibuat oleh: ${ticket.createdBy || 'System'}</p>
                        </div>
                        <div class="ml-2 flex-shrink-0">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColors[ticket.priority]}">
                                ${ticket.priority === 'high' ? 'Tinggi' : 
                                 ticket.priority === 'medium' ? 'Sedang' : 'Rendah'}
                            </span>
                        </div>
                    </div>
                    <div class="mt-2 flex justify-between items-center">
                        <span class="text-xs text-gray-500">
                            ${new Date(ticket.createdAt).toLocaleDateString('id-ID')}
                        </span>
                        <div class="flex space-x-2">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColors[ticket.status]}">
                                ${ticket.status === 'open' ? 'Open' : 
                                 ticket.status === 'in-progress' ? 'In Progress' : 'Resolved'}
                            </span>
                            ${currentUser.role === 'Administrator' ? `
                            <button class="text-blue-600 hover:text-blue-900 text-xs font-medium edit-ticket" data-id="${ticket.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                ticketList.appendChild(ticketItem);
                
                // Add event listener to edit button (admin only)
                if (currentUser.role === 'Administrator') {
                    ticketItem.querySelector('.edit-ticket').addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editTicket(id);
                    });
                }
            });
        }

        function filterTickets() {
            const filter = document.getElementById('ticket-filter').value;
            loadTickets(filter);
        }

        function editTicket(id) {
            const ticket = db.tickets.find(t => t.id === id);
            if (!ticket) return;
            
            const newStatus = prompt(
                'Update status tiket:\n1. Open\n2. In Progress\n3. Resolved', 
                ticket.status
            );
            
            if (newStatus && ['open', 'in-progress', 'resolved'].includes(newStatus)) {
                const oldStatus = ticket.status;
                ticket.status = newStatus;
                ticket.updatedAt = new Date().toISOString();
                saveToLocalStorage();
                loadTickets(document.getElementById('ticket-filter').value);
                
                // Add notification
                addNotification('Tiket Diupdate', `Status tiket "${ticket.title}" diubah dari ${oldStatus} menjadi ${newStatus}`);
            }
        }

        // ==================== USER MANAGEMENT SYSTEM ====================
        function addUser(e) {
            e.preventDefault();
            
            const name = document.getElementById('user-name').value;
            const username = document.getElementById('user-username').value;
            const password = document.getElementById('user-password').value;
            const role = document.getElementById('user-role').value;
            const department = document.getElementById('user-department').value;
            
            // Check if username already exists
            if (db.users.some(u => u.username === username)) {
                alert('Username sudah digunakan');
                return;
            }
            
            // Create new user
            const user = {
                id: Date.now(),
                name,
                username,
                password,
                role,
                department,
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            db.users.push(user);
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('user-form').reset();
            
            // Reload users
            loadUsers();
            
            // Add notification
            addNotification('User Baru', `User ${name} telah ditambahkan sebagai ${role}`);
        }

        function loadUsers(searchTerm = '') {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            
            let users = db.users;
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                users = users.filter(u => 
                    u.name.toLowerCase().includes(term) || 
                    u.username.toLowerCase().includes(term) ||
                    u.role.toLowerCase().includes(term) ||
                    u.department.toLowerCase().includes(term)
                );
            }
            
            if (users.length === 0) {
                userList.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-3 py-4 text-center text-xs text-gray-500">
                            Tidak ada user yang ditemukan
                        </td>
                    </tr>
                `;
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'text-xs';
                row.innerHTML = `
                    <td class="px-3 py-2">${user.name}</td>
                    <td class="px-3 py-2">${user.username}</td>
                    <td class="px-3 py-2">${user.role}</td>
                    <td class="px-3 py-2">${user.department}</td>
                    <td class="px-3 py-2 text-right">
                        <button class="text-blue-600 hover:text-blue-900 mr-2 edit-user" data-id="${user.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 delete-user" data-id="${user.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                userList.appendChild(row);
                
                // Add event listeners to buttons
                row.querySelector('.edit-user').addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editUser(id);
                });
                
                row.querySelector('.delete-user').addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteUser(id);
                });
            });
        }

        function searchUsers() {
            const searchTerm = this.value;
            loadUsers(searchTerm);
        }

        function editUser(id) {
            const user = db.users.find(u => u.id === id);
            if (!user) return;
            
            const newName = prompt('Edit nama:', user.name);
            if (newName === null) return;
            
            const newUsername = prompt('Edit username:', user.username);
            if (newUsername === null) return;
            
            const newRole = prompt('Edit role (Administrator/Teknisi):', user.role);
            if (newRole === null) return;
            
            const newDepartment = prompt('Edit departemen:', user.department);
            if (newDepartment === null) return;
            
            // Update user
            user.name = newName;
            user.username = newUsername;
            user.role = newRole;
            user.department = newDepartment;
            
            saveToLocalStorage();
            loadUsers();
            
            // Add notification
            addNotification('User Diupdate', `Data user ${user.name} telah diperbarui`);
        }

        function deleteUser(id) {
            const user = db.users.find(u => u.id === id);
            
            if (user && confirm(`Apakah Anda yakin ingin menghapus user ${user.name}?`)) {
                db.users = db.users.filter(u => u.id !== id);
                saveToLocalStorage();
                loadUsers();
                
                // Add notification
                addNotification('User Dihapus', `User ${user.name} telah dihapus`);
            }
        }

        // ==================== ANALYTICS SYSTEM ====================
        function showProductivityData() {
            // For dashboard - simple stats
            const userReports = db.reports.filter(r => r.userId === currentUser.id);
            const completedTasks = userReports.filter(r => r.status === 'completed').length;
            const pendingTasks = userReports.filter(r => r.status === 'pending').length;
            
            document.getElementById('tasks-completed').textContent = completedTasks;
            document.getElementById('efficiency-score').textContent = 
                userReports.length > 0 ? Math.round((completedTasks / userReports.length) * 100) + '%' : '0%';
            
            // Simple chart for dashboard
            updateProductivityChart({
                labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'],
                data: [30, 45, 60, 75, 90, userReports.length > 0 ? Math.round((completedTasks / userReports.length) * 100) : 0]
            });
            
            document.getElementById('analytics-section').style.display = 'block';
        }

        function showAnalyticsData() {
            // Weekly productivity chart - based on user reports
            const userReports = db.reports.filter(r => r.userId === currentUser.id);
            
            // Calculate weekly productivity (simplified)
            const weeklyData = [0, 0, 0, 0, 0, 0, 0]; // Sun-Sat
            userReports.forEach(report => {
                const day = new Date(report.date).getDay(); // 0=Sun, 6=Sat
                weeklyData[day] += report.status === 'completed' ? 1 : 0;
            });
            
            // Calculate averages
            const weeklyChartData = {
                labels: ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'],
                data: weeklyData
            };
            
            // Task distribution - based on all tasks in reports
            const completedTasks = userReports.filter(r => r.status === 'completed').length;
            const inProgressTasks = userReports.filter(r => r.status === 'in-progress').length;
            const pendingTasks = userReports.filter(r => r.status === 'pending').length;
            const proposalTasks = userReports.filter(r => r.status === 'proposal').length;
            
            const taskDistributionData = {
                labels: ['Selesai', 'Dalam Proses', 'Pending', 'Usulan'],
                data: [completedTasks, inProgressTasks, pendingTasks, proposalTasks],
                colors: ['#4f46e5', '#a5b4fc', '#e5e7eb', '#818cf8']
            };
            
            // Update charts
            updateWeeklyProductivityChart(weeklyChartData);
            updateTaskDistributionChart(taskDistributionData);
            
            // Calculate average work hours from attendance
            const userAttendance = db.attendance.filter(a => a.userId === currentUser.id && a.duration);
            const totalMinutes = userAttendance.reduce((sum, att) => sum + att.duration, 0);
            const avgMinutes = userAttendance.length > 0 ? Math.round(totalMinutes / userAttendance.length) : 0;
            const avgHours = Math.floor(avgMinutes / 60);
            const avgMins = avgMinutes % 60;
            
            // Update metrics
            document.getElementById('avg-work-hours').textContent = `${avgHours}h ${avgMins}m`;
            document.getElementById('total-completed-tasks').textContent = completedTasks;
            document.getElementById('total-pending-tasks').textContent = pendingTasks;
            
            // Calculate overall productivity score
            const totalProductivity = userReports.length > 0 ? 
                Math.round((completedTasks / userReports.length) * 100) : 0;
            document.getElementById('productivity-score').textContent = `${totalProductivity}%`;
        }

        function showTeamProductivityData() {
            // Team productivity chart - based on all reports
            const teamReports = db.reports;
            
            // Group by user
            const userProductivity = {};
            db.users.forEach(user => {
                const userReports = teamReports.filter(r => r.userId === user.id);
                const completed = userReports.filter(r => r.status === 'completed').length;
                const total = userReports.length;
                
                userProductivity[user.name] = {
                    completed,
                    total,
                    efficiency: total > 0 ? Math.round((completed / total) * 100) : 0
                };
            });
            
            // Prepare chart data
            const teamChartData = {
                labels: Object.keys(userProductivity),
                data: Object.values(userProductivity).map(u => u.efficiency)
            };
            
            // Task distribution by status
            const completedTasks = teamReports.filter(r => r.status === 'completed').length;
            const inProgressTasks = teamReports.filter(r => r.status === 'in-progress').length;
            const pendingTasks = teamReports.filter(r => r.status === 'pending').length;
            const proposalTasks = teamReports.filter(r => r.status === 'proposal').length;
            
            const teamTaskDistributionData = {
                labels: ['Selesai', 'Dalam Proses', 'Pending', 'Usulan'],
                data: [completedTasks, inProgressTasks, pendingTasks, proposalTasks],
                colors: ['#4f46e5', '#a5b4fc', '#e5e7eb', '#818cf8']
            };
            
            // Update charts
            updateTeamProductivityChart(teamChartData);
            updateTeamTaskDistributionChart(teamTaskDistributionData);
            
            // Load team performance table
            loadTeamPerformanceTable(userProductivity);
        }

        function loadTeamPerformanceTable(userProductivity) {
            const performanceList = document.getElementById('team-performance-list');
            performanceList.innerHTML = '';
            
            db.users.forEach(user => {
                const stats = userProductivity[user.name] || { completed: 0, total: 0, efficiency: 0 };
                
                // Calculate average work hours for each user
                const userAttendance = db.attendance.filter(a => a.userId === user.id && a.duration);
                const totalMinutes = userAttendance.reduce((sum, att) => sum + att.duration, 0);
                const avgMinutes = userAttendance.length > 0 ? Math.round(totalMinutes / userAttendance.length) : 0;
                const avgHours = Math.floor(avgMinutes / 60);
                const avgMins = avgMinutes % 60;
                
                const row = document.createElement('tr');
                row.className = 'text-xs';
                row.innerHTML = `
                    <td class="px-3 py-2">${user.name}</td>
                    <td class="px-3 py-2">${stats.total}</td>
                    <td class="px-3 py-2">${stats.completed}</td>
                    <td class="px-3 py-2">${stats.total - stats.completed}</td>
                    <td class="px-3 py-2">${stats.total > 0 ? stats.total - stats.completed : 0}</td>
                    <td class="px-3 py-2">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            stats.efficiency > 80 ? 'bg-green-100 text-green-800' :
                            stats.efficiency > 50 ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${stats.efficiency}%
                        </span>
                    </td>
                    <td class="px-3 py-2">${avgHours}h ${avgMins}m</td>
                `;
                
                performanceList.appendChild(row);
            });
        }

        function updateProductivityChart(data) {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            
            if (productivityChart) {
                productivityChart.destroy();
            }
            
            productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Produktivitas',
                        data: data.data,
                        backgroundColor: '#4f46e5',
                        borderColor: '#4f46e5',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateWeeklyProductivityChart(data) {
            const ctx = document.getElementById('weekly-productivity-chart').getContext('2d');
            
            if (weeklyProductivityChart) {
                weeklyProductivityChart.destroy();
            }
            
            weeklyProductivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Perbaikan Selesai',
                        data: data.data,
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderColor: '#4f46e5',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateTaskDistributionChart(data) {
            const ctx = document.getElementById('task-distribution-chart').getContext('2d');
            
            if (taskDistributionChart) {
                taskDistributionChart.destroy();
            }
            
            taskDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: data.colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        function updateTeamProductivityChart(data) {
            const ctx = document.getElementById('team-productivity-chart').getContext('2d');
            
            if (teamProductivityChart) {
                teamProductivityChart.destroy();
            }
            
            teamProductivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Efisiensi (%)',
                        data: data.data,
                        backgroundColor: '#4f46e5',
                        borderColor: '#4f46e5',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateTeamTaskDistributionChart(data) {
            const ctx = document.getElementById('team-task-distribution-chart').getContext('2d');
            
            if (teamTaskDistributionChart) {
                teamTaskDistributionChart.destroy();
            }
            
            teamTaskDistributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: data.colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // ==================== NAVIGATION ====================
        function showDashboard() {
            hideAllContent();
            document.getElementById('dashboard-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Dashboard';
            updateActiveMenu('home-menu');
        }

        function showAttendanceContent() {
            hideAllContent();
            document.getElementById('attendance-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Absensi';
            updateActiveMenu('attendance-menu');
            loadAttendanceHistory();
        }

        function showReportContent() {
            hideAllContent();
            document.getElementById('report-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Laporan Perbaikan';
            updateActiveMenu('report-menu');
            loadReportHistory();
        }

        function showTicketContent() {
            hideAllContent();
            document.getElementById('ticket-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Daftar Tiket';
            updateActiveMenu('ticket-menu');
            loadTickets();
        }

        function showUserManagementContent() {
            hideAllContent();
            document.getElementById('user-management-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Manajemen User';
            updateActiveMenu('user-management-menu');
            loadUsers();
        }

        function showTeamProductivityContent() {
            hideAllContent();
            document.getElementById('productivity-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Produktivitas Team';
            updateActiveMenu('productivity-menu');
            showTeamProductivityData();
        }

        function showAnalyticsContent() {
            hideAllContent();
            document.getElementById('analytics-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Analisis Saya';
            updateActiveMenu('analytics-menu');
            showAnalyticsData();
        }

        function hideAllContent() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('attendance-content').style.display = 'none';
            document.getElementById('report-content').style.display = 'none';
            document.getElementById('ticket-content').style.display = 'none';
            document.getElementById('user-management-content').style.display = 'none';
            document.getElementById('productivity-content').style.display = 'none';
            document.getElementById('analytics-content').style.display = 'none';
            
            // Reset all menu items
            document.querySelectorAll('nav a').forEach(item => {
                item.classList.remove('bg-blue-800');
                item.classList.add('text-blue-200');
            });
            
            // Close mobile sidebar if open
            sidebar.classList.add('-translate-x-full');
            mobileSidebarOverlay.style.display = 'none';
        }

        function updateActiveMenu(menuId) {
            document.querySelectorAll('nav a').forEach(item => {
                item.classList.remove('bg-blue-800');
                item.classList.add('text-blue-200');
            });
            
            const activeMenu = document.getElementById(menuId);
            activeMenu.classList.add('bg-blue-800');
            activeMenu.classList.remove('text-blue-200');
        }

        // ==================== UTILITY FUNCTIONS ====================
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('sidebar-username').textContent = currentUser.name;
            document.getElementById('sidebar-role').textContent = currentUser.role;
            document.getElementById('topbar-username').textContent = currentUser.name;
        }

        function loadAttendanceHistory() {
            const historyBody = document.getElementById('attendance-history');
            historyBody.innerHTML = '';
            
            let userAttendance;
            
            if (currentUser.role === 'Administrator') {
                // Admin can see all attendance
                userAttendance = db.attendance
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
            } else {
                // Regular users can only see their own attendance
                userAttendance = db.attendance
                    .filter(a => a.userId === currentUser.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            if (userAttendance.length === 0) {
                historyBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-3 py-4 text-center text-xs text-gray-500">
                            Tidak ada riwayat absensi
                        </td>
                    </tr>
                `;
                return;
            }
            
            userAttendance.forEach(att => {
                const row = document.createElement('tr');
                
                const date = new Date(att.date);
                const clockIn = att.clockIn ? new Date(att.clockIn).toLocaleTimeString('id-ID') : '--:--';
                const clockOut = att.clockOut ? new Date(att.clockOut).toLocaleTimeString('id-ID') : '--:--';
                let duration = '0h 0m';
                
                if (att.duration) {
                    const hours = Math.floor(att.duration / 60);
                    const minutes = att.duration % 60;
                    duration = `${hours}h ${minutes}m`;
                }
                
                // Get user name for admin view
                const user = db.users.find(u => u.id === att.userId);
                const userName = user ? user.name : 'Unknown';
                
                row.innerHTML = `
                    ${currentUser.role === 'Administrator' ? `
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${userName}
                    </td>
                    ` : ''}
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${date.toLocaleDateString('id-ID')}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${clockIn}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${clockOut}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">
                        ${duration}
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${att.status === 'present' ? 'Hadir' : att.status === 'late' ? 'Terlambat' : 'Absen'}
                        </span>
                    </td>
                    ${currentUser.role === 'Administrator' ? `
                    <td class="px-3 py-2 whitespace-nowrap text-right text-xs font-medium">
                        <button class="text-blue-600 hover:text-blue-900 mr-2 edit-attendance" data-id="${att.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 delete-attendance" data-id="${att.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                    ` : ''}
                `;
                
                historyBody.appendChild(row);
            });
            
            // Add event listeners to buttons (admin only)
            if (currentUser.role === 'Administrator') {
                document.querySelectorAll('.edit-attendance').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editAttendance(id);
                    });
                });
                
                document.querySelectorAll('.delete-attendance').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteAttendanceRecord(id);
                    });
                });
            }
        }

        function editAttendance(id) {
            const attendance = db.attendance.find(a => a.id === id);
            if (!attendance) return;
            
            const newClockIn = prompt('Masukkan waktu absen masuk (HH:MM):', 
                attendance.clockIn ? new Date(attendance.clockIn).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'}) : '');
            
            if (newClockIn) {
                const [hours, minutes] = newClockIn.split(':');
                const date = new Date(attendance.date);
                date.setHours(parseInt(hours), parseInt(minutes));
                attendance.clockIn = date;
                
                if (attendance.clockOut) {
                    attendance.duration = Math.round((attendance.clockOut - attendance.clockIn) / (1000 * 60));
                }
                
                saveToLocalStorage();
                loadAttendanceHistory();
                
                // Add notification
                addNotification('Absen Diupdate', 'Data absensi telah diperbarui');
            }
        }

        function deleteAttendanceRecord(id) {
            const attendance = db.attendance.find(a => a.id === id);
            
            if (attendance && confirm('Apakah Anda yakin ingin menghapus absensi ini?')) {
                db.attendance = db.attendance.filter(a => a.id !== id);
                saveToLocalStorage();
                loadAttendanceHistory();
                
                // Add notification
                addNotification('Absen Dihapus', `Absensi tanggal ${new Date(attendance.date).toLocaleDateString('id-ID')} telah dihapus`);
            }
        }
    </script>
</body>
</html>