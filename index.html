<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Productivity Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-sm w-full">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Masuk Sistem</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="login-username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Kata Sandi</label>
                    <input type="password" id="login-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Masuk
                </button>
            </form>
        </div>
    </div>

    <div class="flex h-screen overflow-hidden" id="main-content" style="display: none;">
        <!-- Sidebar -->
        <div class="hidden md:flex md:flex-shrink-0">
            <div class="flex flex-col w-64 bg-indigo-700 text-white">
                <div class="flex items-center justify-center h-16 px-4 border-b border-indigo-600">
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <span class="ml-2 text-xl font-bold">WorkAI</span>
                    </div>
                </div>
                <div class="flex flex-col flex-grow px-4 py-4 overflow-y-auto">
                    <nav class="space-y-2">
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-indigo-800" id="home-menu">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            Beranda
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-indigo-200 hover:bg-indigo-800" id="attendance-menu">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            Absensi
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-indigo-200 hover:bg-indigo-800" id="report-menu">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Laporan Kerja
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-indigo-200 hover:bg-indigo-800" id="ticket-menu">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Daftar Tiket
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium rounded-lg text-indigo-200 hover:bg-indigo-800" id="analytics-menu">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Analisis
                        </a>
                    </nav>
                    <div class="mt-auto px-4 py-6">
                        <div class="bg-indigo-800 rounded-lg px-4 py-3">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 rounded-full bg-indigo-600 p-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <div class="ml-3">
                                    <p class="text-sm font-medium" id="sidebar-username">Admin</p>
                                    <p class="text-xs text-indigo-300" id="sidebar-role">Administrator</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Top navigation -->
            <div class="flex items-center justify-between h-16 px-6 border-b border-gray-200 bg-white">
                <div class="flex items-center md:hidden">
                    <button class="text-gray-500 hover:text-gray-700 focus:outline-none" id="mobile-menu-button">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-xl font-semibold text-gray-800" id="page-title">Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="relative text-gray-500 hover:text-gray-700 focus:outline-none" id="notifications-button">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"></span>
                    </button>
                    <div class="relative">
                        <button class="flex items-center text-sm font-medium focus:outline-none" id="user-menu-button">
                            <span class="sr-only">Open user menu</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 rounded-full bg-gray-200 p-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <span class="ml-2 hidden md:inline-block" id="topbar-username">Admin</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main content area -->
            <div class="flex-1 overflow-auto p-6 bg-gray-50" id="content-area">
                <!-- Dashboard Content -->
                <div id="dashboard-content">
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
                        <!-- Attendance Card -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-6">
                                <div class="flex items-center justify-between">
                                    <h2 class="text-lg font-semibold text-gray-800">Absensi</h2>
                                    <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800" id="attendance-status">Aktif</span>
                                </div>
                                <div id="location-display" class="mt-4 text-sm text-gray-600 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span>Menentukan lokasi...</span>
                                </div>
                                <div class="mt-6 flex justify-center">
                                    <button id="attendance-btn" class="px-8 py-3 bg-indigo-600 text-white rounded-full font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors">
                                        Absen Masuk
                                    </button>
                                </div>
                                <div class="mt-4" style="display:none" id="attendance-records">
                                    <p class="text-sm text-gray-500">Rekaman hari ini:</p>
                                    <div class="mt-2 space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Absen Masuk:</span>
                                            <span id="clock-in-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Absen Keluar:</span>
                                            <span id="clock-out-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Durasi:</span>
                                            <span id="work-duration" class="font-medium text-indigo-600">0h 0m</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-600">Lokasi:</span>
                                            <span id="attendance-location" class="font-medium">--</span>
                                        </div>
                                        <div class="flex justify-end">
                                            <button id="delete-attendance" class="text-red-600 hover:text-red-900 text-sm font-medium">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                </svg>
                                                Hapus
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Productivity Stats -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1" style="display:none" id="analytics-section">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Produktivitas</h2>
                                <div class="mt-6">
                                    <div class="relative h-40">
                                        <canvas id="productivityChart"></canvas>
                                    </div>
                                    <div class="mt-6 grid grid-cols-3 gap-4 text-center">
                                        <div>
                                            <p class="text-sm text-gray-500">Tugas Selesai</p>
                                            <p id="tasks-completed" class="text-2xl font-bold text-indigo-600">0</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Rata Fokus</p>
                                            <p id="avg-focus-time" class="text-2xl font-bold text-indigo-600">0h 0m</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Efisiensi</p>
                                            <p id="efficiency-score" class="text-2xl font-bold text-indigo-600">0%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Recommendations -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Rekomendasi AI</h2>
                                <div class="mt-6">
                                    <div class="flex items-start">
                                        <div class="flex-shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                            </svg>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm text-gray-600" id="ai-recommendation">
                                                Mulailah hari Anda dengan membuat daftar tugas prioritas. Fokus pada tugas-tugas penting terlebih dahulu.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Report Section -->
                    <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
                        <!-- Submit Report -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Laporan Harian</h2>
                                <form id="report-form" class="mt-4 space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Judul Laporan</label>
                                        <input type="text" id="report-title" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Deskripsi</label>
                                        <textarea id="report-description" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Daftar Tugas</label>
                                        <div id="tasks-container" class="mt-2 space-y-2">
                                            <!-- Tasks will be added here -->
                                        </div>
                                        <button type="button" id="add-task-btn" class="mt-2 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                            </svg>
                                            Tambah Tugas
                                        </button>
                                    </div>
                                    <div>
                                        <button type="submit" id="submit-report-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Submit Laporan
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Report Display -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden" style="display:none" id="report-section">
                            <div class="p-6">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-lg font-semibold text-gray-800">Laporan Terakhir</h2>
                                    <div class="flex space-x-2">
                                        <button id="edit-report-btn" class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                            Edit
                                        </button>
                                        <button id="delete-report-btn" class="text-red-600 hover:text-red-900 text-sm font-medium">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                            Hapus
                                        </button>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h3 id="report-title-display" class="text-md font-medium text-gray-900"></h3>
                                    <p id="report-description-display" class="mt-2 text-sm text-gray-600"></p>
                                    <div class="mt-4">
                                        <h4 class="text-sm font-medium text-gray-700">Daftar Tugas</h4>
                                        <div id="report-tasks-list" class="mt-2 space-y-2">
                                            <!-- Tasks will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Content (hidden by default) -->
                <div id="attendance-content" style="display: none;">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-lg font-semibold text-gray-800">Riwayat Absensi</h2>
                            <div class="mt-4">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Masuk</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keluar</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durasi</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="attendance-history">
                                            <!-- Attendance records will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Content (hidden by default) -->
                <div id="report-content" style="display: none;">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-lg font-semibold text-gray-800">Riwayat Laporan</h2>
                            <div class="mt-4">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judul</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tugas Selesai</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="report-history">
                                            <!-- Report records will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Content (hidden by default) -->
                <div id="ticket-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
                        <!-- Create Ticket -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-1">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Buat Tiket Baru</h2>
                                <form id="ticket-form" class="mt-4 space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Judul Tiket</label>
                                        <input type="text" id="ticket-title" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Deskripsi</label>
                                        <textarea id="ticket-description" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Prioritas</label>
                                        <select id="ticket-priority" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="low">Rendah</option>
                                            <option value="medium" selected>Sedang</option>
                                            <option value="high">Tinggi</option>
                                        </select>
                                    </div>
                                    <div>
                                        <button type="submit" id="submit-ticket-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Buat Tiket
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Ticket List -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-6">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-lg font-semibold text-gray-800">Daftar Tiket</h2>
                                    <div class="flex space-x-2">
                                        <select id="ticket-filter" class="mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="all">Semua</option>
                                            <option value="open">Open</option>
                                            <option value="in-progress">In Progress</option>
                                            <option value="resolved">Resolved</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="overflow-y-auto" style="max-height: 500px;">
                                        <div class="space-y-4" id="ticket-list">
                                            <!-- Tickets will be loaded here -->
                                            <div class="text-center py-10 text-gray-500">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                                </svg>
                                                <p class="mt-2">Belum ada tiket yang dibuat</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Content (hidden by default) -->
                <div id="analytics-content" style="display: none;">
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                        <!-- Productivity Chart -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Produktivitas Mingguan</h2>
                                <div class="mt-4">
                                    <div class="relative h-64">
                                        <canvas id="weekly-productivity-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Task Distribution -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Distribusi Tugas</h2>
                                <div class="mt-4">
                                    <div class="relative h-64">
                                        <canvas id="task-distribution-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden col-span-2">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-gray-800">Metrik Kinerja</h2>
                                <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4">
                                    <div class="bg-indigo-50 rounded-lg p-4">
                                        <p class="text-sm font-medium text-indigo-800">Rata-rata Jam Kerja</p>
                                        <p class="mt-1 text-2xl font-bold text-indigo-600" id="avg-work-hours">6h 24m</p>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <p class="text-sm font-medium text-green-800">Tugas Selesai</p>
                                        <p class="mt-1 text-2xl font-bold text-green-600" id="total-completed-tasks">42</p>
                                    </div>
                                    <div class="bg-yellow-50 rounded-lg p-4">
                                        <p class="text-sm font-medium text-yellow-800">Tugas Tertunda</p>
                                        <p class="mt-1 text-2xl font-bold text-yellow-600" id="total-pending-tasks">8</p>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <p class="text-sm font-medium text-purple-800">Skor Produktivitas</p>
                                        <p class="mt-1 text-2xl font-bold text-purple-600" id="productivity-score">84%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Simulated database
        const db = {
            users: [
                { id: 1, username: 'admin', password: 'admin123', name: 'Admin', role: 'Administrator' }
            ],
            attendance: [],
            reports: [],
            tickets: []
        };

        // Current user
        let currentUser = null;

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const token = localStorage.getItem('token');
            if (token) {
                currentUser = JSON.parse(localStorage.getItem('user'));
                showMainContent();
            } else {
                document.getElementById('login-modal').style.display = 'flex';
            }

            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                
                const user = db.users.find(u => u.username === username && u.password === password);
                if (user) {
                    currentUser = user;
                    localStorage.setItem('token', 'simulated-token');
                    localStorage.setItem('user', JSON.stringify(user));
                    document.getElementById('login-modal').style.display = 'none';
                    showMainContent();
                } else {
                    alert('Username atau password salah');
                }
            });

            // Navigation menu
            document.getElementById('home-menu').addEventListener('click', showDashboard);
            document.getElementById('attendance-menu').addEventListener('click', showAttendanceContent);
            document.getElementById('report-menu').addEventListener('click', showReportContent);
            document.getElementById('ticket-menu').addEventListener('click', showTicketContent);
            document.getElementById('analytics-menu').addEventListener('click', showAnalyticsContent);

            // Attendance
            document.getElementById('attendance-btn').addEventListener('click', handleAttendance);
            document.getElementById('delete-attendance').addEventListener('click', deleteAttendance);

            // Report
            document.getElementById('add-task-btn').addEventListener('click', addTask);
            document.getElementById('report-form').addEventListener('submit', submitReport);
            document.getElementById('edit-report-btn').addEventListener('click', editReport);
            document.getElementById('delete-report-btn').addEventListener('click', deleteReport);

            // Ticket
            document.getElementById('ticket-form').addEventListener('submit', submitTicket);
            document.getElementById('ticket-filter').addEventListener('change', filterTickets);

            // Initialize
            if (currentUser) {
                checkAttendanceStatus();
                loadReports();
                loadTickets();
                updateUserInfo();
            }
        });

        // Show main content after login
        function showMainContent() {
            document.getElementById('main-content').style.display = 'flex';
            showDashboard();
            updateUserInfo();
        }

        // Update user info in sidebar and topbar
        function updateUserInfo() {
            document.getElementById('sidebar-username').textContent = currentUser.name;
            document.getElementById('sidebar-role').textContent = currentUser.role;
            document.getElementById('topbar-username').textContent = currentUser.name;
        }

        // Navigation functions
        function showDashboard() {
            hideAllContent();
            document.getElementById('dashboard-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Dashboard';
            document.getElementById('home-menu').classList.add('bg-indigo-800');
            document.getElementById('home-menu').classList.remove('text-indigo-200');
        }

        function showAttendanceContent() {
            hideAllContent();
            document.getElementById('attendance-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Absensi';
            updateActiveMenu('attendance-menu');
            loadAttendanceHistory();
        }

        function showReportContent() {
            hideAllContent();
            document.getElementById('report-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Laporan Kerja';
            updateActiveMenu('report-menu');
            loadReportHistory();
        }

        function showTicketContent() {
            hideAllContent();
            document.getElementById('ticket-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Daftar Tiket';
            updateActiveMenu('ticket-menu');
            loadTickets();
        }

        function showAnalyticsContent() {
            hideAllContent();
            document.getElementById('analytics-content').style.display = 'block';
            document.getElementById('page-title').textContent = 'Analisis Produktivitas';
            updateActiveMenu('analytics-menu');
            showAnalyticsData();
        }

        function hideAllContent() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('attendance-content').style.display = 'none';
            document.getElementById('report-content').style.display = 'none';
            document.getElementById('ticket-content').style.display = 'none';
            document.getElementById('analytics-content').style.display = 'none';
            
            // Reset all menu items
            document.querySelectorAll('nav a').forEach(item => {
                item.classList.remove('bg-indigo-800');
                item.classList.add('text-indigo-200');
            });
        }

        function updateActiveMenu(menuId) {
            document.querySelectorAll('nav a').forEach(item => {
                item.classList.remove('bg-indigo-800');
                item.classList.add('text-indigo-200');
            });
            
            const activeMenu = document.getElementById(menuId);
            activeMenu.classList.add('bg-indigo-800');
            activeMenu.classList.remove('text-indigo-200');
        }

        // Attendance functions
        async function getLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            resolve(`Lat: ${position.coords.latitude}, Long: ${position.coords.longitude}`);
                        },
                        () => {
                            resolve('Lokasi tidak diketahui');
                        }
                    );
                } else {
                    resolve('Lokasi tidak didukung');
                }
            });
        }

        async function handleAttendance() {
            const btn = document.getElementById('attendance-btn');
            
            if (btn.textContent === 'Absen Masuk') {
                const location = await getLocation();
                document.getElementById('location-display').innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>${location}</span>
                `;
                
                // Simulate API call
                const now = new Date();
                const attendance = {
                    id: Date.now(),
                    userId: currentUser.id,
                    date: now,
                    clockIn: now,
                    location,
                    status: 'present'
                };
                
                db.attendance.push(attendance);
                
                updateAttendanceUI(attendance);
                btn.textContent = 'Absen Keluar';
                showNotification('Absen masuk berhasil dicatat');
            } else {
                // Simulate API call for clock out
                const now = new Date();
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const attendance = db.attendance.find(a => 
                    a.userId === currentUser.id && 
                    new Date(a.date) >= today && 
                    !a.clockOut
                );
                
                if (attendance) {
                    attendance.clockOut = now;
                    attendance.duration = Math.round((attendance.clockOut - attendance.clockIn) / (1000 * 60));
                    updateAttendanceUI(attendance);
                    btn.style.display = 'none';
                    showNotification('Absen keluar berhasil dicatat');
                    showProductivityData();
                }
            }
        }

        function updateAttendanceUI(attendance) {
            const recordsDiv = document.getElementById('attendance-records');
            recordsDiv.style.display = 'block';
            
            if (attendance.clockIn) {
                document.getElementById('clock-in-time').textContent = 
                    new Date(attendance.clockIn).toLocaleTimeString('id-ID');
            }
            
            if (attendance.clockOut) {
                document.getElementById('clock-out-time').textContent = 
                    new Date(attendance.clockOut).toLocaleTimeString('id-ID');
            }
            
            if (attendance.duration) {
                const hours = Math.floor(attendance.duration / 60);
                const minutes = attendance.duration % 60;
                document.getElementById('work-duration').textContent = 
                    `${hours}h ${minutes}m`;
            }
            
            if (attendance.location) {
                document.getElementById('attendance-location').textContent = 
                    attendance.location;
            }
        }

        function checkAttendanceStatus() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const attendance = db.attendance.find(a => 
                a.userId === currentUser.id && 
                new Date(a.date) >= today
            );
            
            const btn = document.getElementById('attendance-btn');
            
            if (attendance) {
                updateAttendanceUI(attendance);
                
                if (attendance.clockIn && !attendance.clockOut) {
                    btn.textContent = 'Absen Keluar';
                } else if (attendance.clockIn && attendance.clockOut) {
                    btn.style.display = 'none';
                    showProductivityData();
                }
            }
        }

        function deleteAttendance() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            db.attendance = db.attendance.filter(a => 
                !(a.userId === currentUser.id && new Date(a.date) >= today)
            );
            
            document.getElementById('attendance-records').style.display = 'none';
            document.getElementById('attendance-btn').style.display = 'block';
            document.getElementById('attendance-btn').textContent = 'Absen Masuk';
            document.getElementById('location-display').innerHTML = `
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span>Menentukan lokasi...</span>
            `;
            
            showNotification('Absensi hari ini dihapus');
        }

        function loadAttendanceHistory() {
            const historyBody = document.getElementById('attendance-history');
            historyBody.innerHTML = '';
            
            const userAttendance = db.attendance
                .filter(a => a.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userAttendance.length === 0) {
                historyBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                            Tidak ada riwayat absensi
                        </td>
                    </tr>
                `;
                return;
            }
            
            userAttendance.forEach(att => {
                const row = document.createElement('tr');
                
                const date = new Date(att.date);
                const clockIn = att.clockIn ? new Date(att.clockIn).toLocaleTimeString('id-ID') : '--:--';
                const clockOut = att.clockOut ? new Date(att.clockOut).toLocaleTimeString('id-ID') : '--:--';
                let duration = '0h 0m';
                
                if (att.duration) {
                    const hours = Math.floor(att.duration / 60);
                    const minutes = att.duration % 60;
                    duration = `${hours}h ${minutes}m`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${date.toLocaleDateString('id-ID')}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${clockIn}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${clockOut}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${duration}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${att.status === 'present' ? 'Hadir' : att.status === 'late' ? 'Terlambat' : 'Absen'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-attendance" data-id="${att.id}">Edit</button>
                        <button class="text-red-600 hover:text-red-900 delete-attendance" data-id="${att.id}">Hapus</button>
                    </td>
                `;
                
                historyBody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.edit-attendance').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editAttendance(id);
                });
            });
            
            document.querySelectorAll('.delete-attendance').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteAttendanceRecord(id);
                });
            });
        }

        function editAttendance(id) {
            const attendance = db.attendance.find(a => a.id === id);
            if (!attendance) return;
            
            const newClockIn = prompt('Masukkan waktu absen masuk (HH:MM):', 
                attendance.clockIn ? new Date(attendance.clockIn).toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'}) : '');
            
            if (newClockIn) {
                const [hours, minutes] = newClockIn.split(':');
                const date = new Date(attendance.date);
                date.setHours(parseInt(hours), parseInt(minutes));
                attendance.clockIn = date;
                
                if (attendance.clockOut) {
                    attendance.duration = Math.round((attendance.clockOut - attendance.clockIn) / (1000 * 60));
                }
                
                loadAttendanceHistory();
                showNotification('Absensi berhasil diupdate');
            }
        }

        function deleteAttendanceRecord(id) {
            if (confirm('Apakah Anda yakin ingin menghapus absensi ini?')) {
                db.attendance = db.attendance.filter(a => a.id !== id);
                loadAttendanceHistory();
                showNotification('Absensi berhasil dihapus');
            }
        }

        // Report functions
        function addTask() {
            const tasksContainer = document.getElementById('tasks-container');
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item flex space-x-2 items-center';
            taskItem.innerHTML = `
                <input type="text" class="task-name flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Nama Tugas" required>
                <select class="task-status px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="pending">Pending</option>
                    <option value="in-progress">Dalam Proses</option>
                    <option value="completed">Selesai</option>
                </select>
                <button type="button" class="remove-task-btn px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Hapus</button>
            `;
            
            tasksContainer.appendChild(taskItem);
            
            // Add event listener to remove button
            taskItem.querySelector('.remove-task-btn').addEventListener('click', function() {
                tasksContainer.removeChild(taskItem);
            });
        }

        function submitReport(e) {
            e.preventDefault();
            
            const title = document.getElementById('report-title').value;
            const description = document.getElementById('report-description').value;
            const tasks = [];
            
            document.querySelectorAll('.task-item').forEach(taskItem => {
                tasks.push({
                    name: taskItem.querySelector('.task-name').value,
                    status: taskItem.querySelector('.task-status').value
                });
            });
            
            if (tasks.length === 0) {
                alert('Harap tambahkan minimal satu tugas');
                return;
            }
            
            // Calculate productivity score (simplified)
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const productivityScore = Math.round((completedTasks / tasks.length) * 100);
            
            // Simulate API call
            const report = {
                id: Date.now(),
                userId: currentUser.id,
                date: new Date(),
                title,
                description,
                tasks,
                productivityScore
            };
            
            db.reports.push(report);
            
            // Reset form
            document.getElementById('report-form').reset();
            document.getElementById('tasks-container').innerHTML = '';
            
            // Show report
            showReport(report);
            showProductivityData();
            showNotification('Laporan berhasil disubmit');
        }

        function showReport(report) {
            const reportSection = document.getElementById('report-section');
            reportSection.style.display = 'block';
            
            document.getElementById('report-title-display').textContent = report.title;
            document.getElementById('report-description-display').textContent = report.description;
            
            const tasksList = document.getElementById('report-tasks-list');
            tasksList.innerHTML = '';
            
            report.tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'flex justify-between py-2 border-b border-gray-200';
                taskItem.innerHTML = `
                    <span>${task.name}</span>
                    <span class="px-2 py-1 text-xs rounded-full ${
                        task.status === 'completed' ? 'bg-green-100 text-green-800' : 
                        task.status === 'in-progress' ? 'bg-yellow-100 text-yellow-800' : 
                        'bg-red-100 text-red-800'
                    }">
                        ${task.status === 'completed' ? 'Selesai' : 
                          task.status === 'in-progress' ? 'Dalam Proses' : 'Pending'}
                    </span>
                `;
                tasksList.appendChild(taskItem);
            });
            
            // Store current report ID for edit/delete
            reportSection.setAttribute('data-report-id', report.id);
        }

        function editReport() {
            const reportId = parseInt(document.getElementById('report-section').getAttribute('data-report-id'));
            const report = db.reports.find(r => r.id === reportId);
            if (!report) return;
            
            // Fill form with report data
            document.getElementById('report-title').value = report.title;
            document.getElementById('report-description').value = report.description;
            
            const tasksContainer = document.getElementById('tasks-container');
            tasksContainer.innerHTML = '';
            
            report.tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item flex space-x-2 items-center mb-2';
                taskItem.innerHTML = `
                    <input type="text" class="task-name flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" value="${task.name}" required>
                    <select class="task-status px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>Dalam Proses</option>
                        <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>Selesai</option>
                    </select>
                    <button type="button" class="remove-task-btn px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Hapus</button>
                `;
                
                tasksContainer.appendChild(taskItem);
                
                // Add event listener to remove button
                taskItem.querySelector('.remove-task-btn').addEventListener('click', function() {
                    tasksContainer.removeChild(taskItem);
                });
            });
            
            // Hide report display
            document.getElementById('report-section').style.display = 'none';
            
            // Scroll to form
            document.getElementById('report-form').scrollIntoView({ behavior: 'smooth' });
            
            // Update submit button to say "Update"
            document.getElementById('submit-report-btn').textContent = 'Update Laporan';
            
            // Change form submit handler to update instead of create
            document.getElementById('report-form').onsubmit = function(e) {
                e.preventDefault();
                updateReport(reportId);
            };
        }

        function updateReport(reportId) {
            const reportIndex = db.reports.findIndex(r => r.id === reportId);
            if (reportIndex === -1) return;
            
            const title = document.getElementById('report-title').value;
            const description = document.getElementById('report-description').value;
            const tasks = [];
            
            document.querySelectorAll('.task-item').forEach(taskItem => {
                tasks.push({
                    name: taskItem.querySelector('.task-name').value,
                    status: taskItem.querySelector('.task-status').value
                });
            });
            
            if (tasks.length === 0) {
                alert('Harap tambahkan minimal satu tugas');
                return;
            }
            
            // Calculate productivity score
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const productivityScore = Math.round((completedTasks / tasks.length) * 100);
            
            // Update report
            db.reports[reportIndex] = {
                ...db.reports[reportIndex],
                title,
                description,
                tasks,
                productivityScore
            };
            
            // Reset form
            document.getElementById('report-form').reset();
            document.getElementById('tasks-container').innerHTML = '';
            document.getElementById('submit-report-btn').textContent = 'Submit Laporan';
            
            // Show updated report
            showReport(db.reports[reportIndex]);
            showProductivityData();
            showNotification('Laporan berhasil diupdate');
            
            // Restore original submit handler
            document.getElementById('report-form').onsubmit = submitReport;
        }

        function deleteReport() {
            const reportId = parseInt(document.getElementById('report-section').getAttribute('data-report-id'));
            
            if (confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                db.reports = db.reports.filter(r => r.id !== reportId);
                document.getElementById('report-section').style.display = 'none';
                document.getElementById('report-form').reset();
                document.getElementById('tasks-container').innerHTML = '';
                showProductivityData();
                showNotification('Laporan berhasil dihapus');
            }
        }

        function loadReports() {
            // For dashboard - load latest report
            const userReports = db.reports
                .filter(r => r.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userReports.length > 0) {
                showReport(userReports[0]);
            }
        }

        function loadReportHistory() {
            const historyBody = document.getElementById('report-history');
            historyBody.innerHTML = '';
            
            const userReports = db.reports
                .filter(r => r.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (userReports.length === 0) {
                historyBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                            Tidak ada riwayat laporan
                        </td>
                    </tr>
                `;
                return;
            }
            
            userReports.forEach(report => {
                const row = document.createElement('tr');
                const completedTasks = report.tasks.filter(t => t.status === 'completed').length;
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${new Date(report.date).toLocaleDateString('id-ID')}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        ${report.title}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${completedTasks} dari ${report.tasks.length}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            report.productivityScore > 80 ? 'bg-green-100 text-green-800' :
                            report.productivityScore > 50 ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${report.productivityScore}%
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-indigo-600 hover:text-indigo-900 mr-3 view-report" data-id="${report.id}">Lihat</button>
                        <button class="text-red-600 hover:text-red-900 delete-report" data-id="${report.id}">Hapus</button>
                    </td>
                `;
                
                historyBody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const report = db.reports.find(r => r.id === id);
                    if (report) showReport(report);
                });
            });
            
            document.querySelectorAll('.delete-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    if (confirm('Apakah Anda yakin ingin menghapus laporan ini?')) {
                        db.reports = db.reports.filter(r => r.id !== id);
                        loadReportHistory();
                        showNotification('Laporan berhasil dihapus');
                    }
                });
            });
        }

        // Ticket functions
        function submitTicket(e) {
            e.preventDefault();
            
            const title = document.getElementById('ticket-title').value;
            const description = document.getElementById('ticket-description').value;
            const priority = document.getElementById('ticket-priority').value;
            
            // Simulate API call
            const ticket = {
                id: Date.now(),
                userId: currentUser.id,
                title,
                description,
                status: 'open',
                priority,
                createdAt: new Date()
            };
            
            db.tickets.push(ticket);
            
            // Reset form
            document.getElementById('ticket-form').reset();
            
            // Reload tickets
            loadTickets();
            showNotification('Tiket berhasil dibuat');
        }

        function loadTickets(filter = 'all') {
            const ticketList = document.getElementById('ticket-list');
            ticketList.innerHTML = '';
            
            let userTickets = db.tickets
                .filter(t => t.userId === currentUser.id)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filter !== 'all') {
                userTickets = userTickets.filter(t => t.status === filter);
            }
            
            if (userTickets.length === 0) {
                ticketList.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        <p class="mt-2">Tidak ada tiket yang ditemukan</p>
                    </div>
                `;
                return;
            }
            
            userTickets.forEach(ticket => {
                const ticketItem = document.createElement('div');
                ticketItem.className = 'bg-white rounded-lg shadow p-4';
                
                const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-green-100 text-green-800'
                };
                
                const statusColors = {
                    open: 'bg-blue-100 text-blue-800',
                    'in-progress': 'bg-purple-100 text-purple-800',
                    resolved: 'bg-gray-100 text-gray-800'
                };
                
                ticketItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-lg font-medium text-gray-900">${ticket.title}</h3>
                            <p class="mt-1 text-sm text-gray-600">${ticket.description}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityColors[ticket.priority]}">
                                ${ticket.priority === 'high' ? 'Tinggi' : 
                                 ticket.priority === 'medium' ? 'Sedang' : 'Rendah'}
                            </span>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <span class="text-xs text-gray-500">
                            Dibuat: ${new Date(ticket.createdAt).toLocaleDateString('id-ID')}
                        </span>
                        <div class="flex space-x-2">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColors[ticket.status]}">
                                ${ticket.status === 'open' ? 'Open' : 
                                 ticket.status === 'in-progress' ? 'In Progress' : 'Resolved'}
                            </span>
                            <button class="text-indigo-600 hover:text-indigo-900 text-sm font-medium edit-ticket" data-id="${ticket.id}">
                                Edit
                            </button>
                        </div>
                    </div>
                `;
                
                ticketList.appendChild(ticketItem);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-ticket').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editTicket(id);
                });
            });
        }

        function filterTickets() {
            const filter = document.getElementById('ticket-filter').value;
            loadTickets(filter);
        }

        function editTicket(id) {
            const ticket = db.tickets.find(t => t.id === id);
            if (!ticket) return;
            
            const newStatus = prompt(
                'Update status tiket:\n1. Open\n2. In Progress\n3. Resolved', 
                ticket.status
            );
            
            if (newStatus && ['open', 'in-progress', 'resolved'].includes(newStatus)) {
                ticket.status = newStatus;
                ticket.updatedAt = new Date();
                loadTickets(document.getElementById('ticket-filter').value);
                showNotification('Status tiket berhasil diupdate');
            }
        }

        // Analytics functions
        function showProductivityData() {
            // For dashboard - simple stats
            const todayReport = db.reports
                .filter(r => r.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
            
            if (todayReport) {
                const completedTasks = todayReport.tasks.filter(t => t.status === 'completed').length;
                document.getElementById('tasks-completed').textContent = completedTasks;
                document.getElementById('efficiency-score').textContent = todayReport.productivityScore + '%';
                
                // Simple chart for dashboard
                updateProductivityChart({
                    labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'],
                    data: [30, 45, 60, 75, 90, todayReport.productivityScore]
                });
            }
            
            document.getElementById('analytics-section').style.display = 'block';
        }

        function showAnalyticsData() {
            // Weekly productivity chart
            const weeklyChartData = {
                labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                data: [65, 59, 80, 81, 56, 55, 40]
            };
            
            // Task distribution chart
            const taskDistributionData = {
                labels: ['Selesai', 'Dalam Proses', 'Pending'],
                data: [12, 5, 3],
                colors: ['#4f46e5', '#a5b4fc', '#e5e7eb']
            };
            
            // Update charts
            updateWeeklyProductivityChart(weeklyChartData);
            updateTaskDistributionChart(taskDistributionData);
            
            // Update metrics
            document.getElementById('avg-work-hours').textContent = '6h 24m';
            document.getElementById('total-completed-tasks').textContent = '42';
            document.getElementById('total-pending-tasks').textContent = '8';
            document.getElementById('productivity-score').textContent = '84%';
        }

        function updateProductivityChart(data) {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            
            if (window.productivityChart) {
                window.productivityChart.destroy();
            }
            
            window.productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Produktivitas',
                        data: data.data,
                        backgroundColor: '#4f46e5',
                        borderColor: '#4f46e5',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateWeeklyProductivityChart(data) {
            const ctx = document.getElementById('weekly-productivity-chart').getContext('2d');
            
            if (window.weeklyProductivityChart) {
                window.weeklyProductivityChart.destroy();
            }
            
            window.weeklyProductivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Produktivitas',
                        data: data.data,
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderColor: '#4f46e5',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateTaskDistributionChart(data) {
            const ctx = document.getElementById('task-distribution-chart').getContext('2d');
            
            if (window.taskDistributionChart) {
                window.taskDistributionChart.destroy();
            }
            
            window.taskDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: data.colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Helper functions
        function showNotification(message) {
            // In a real app, you'd use a proper notification system
            alert(message);
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>